# ğŸ”„ SYSTEM FLOW DIAGRAM
## Adaptive AI Knowledge Workspace - Complete Architecture

---

## ğŸ¯ **AUTHENTICATION FLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER SIGNUP FLOW                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User fills form          Frontend validates       API receives
(name, email, pass)  â†’   (email format, etc.)  â†’  POST /api/auth/signup
                                                    â”‚
                                                    â†“
                                            Check if email exists
                                                    â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚                               â”‚
                                  EXISTS                        NEW USER
                                    â”‚                               â”‚
                                    â†“                               â†“
                            Return 409 error              Hash password (bcrypt)
                                                                    â”‚
                                                                    â†“
                                                          Save to MongoDB
                                                          (users collection)
                                                                    â”‚
                                                                    â†“
                                                          Generate JWT token
                                                          (expires in 7 days)
                                                                    â”‚
                                                                    â†“
                                                          Return token + user
                                                                    â”‚
                                                                    â†“
                                                          Frontend stores:
                                                          - localStorage.token
                                                          - localStorage.user
                                                                    â”‚
                                                                    â†“
                                                          Auto-redirect to
                                                          /dashboard

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          USER LOGIN FLOW                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User enters              Frontend validates       API receives
(email, password)    â†’   (not empty)          â†’   POST /api/auth/login
                                                    â”‚
                                                    â†“
                                            Find user by email
                                                    â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚                               â”‚
                                NOT FOUND                         FOUND
                                    â”‚                               â”‚
                                    â†“                               â†“
                            Return 401 error              Compare passwords
                            "Invalid credentials"         (bcrypt.compare)
                                                                    â”‚
                                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                    â”‚                               â”‚
                                                MISMATCH                         MATCH
                                                    â”‚                               â”‚
                                                    â†“                               â†“
                                            Return 401 error              Generate JWT token
                                            "Invalid credentials"                   â”‚
                                                                                    â†“
                                                                          Return token + user
                                                                                    â”‚
                                                                                    â†“
                                                                          Frontend stores token
                                                                                    â”‚
                                                                                    â†“
                                                                          Redirect to /dashboard
```

---

## ğŸ“ **DATA CREATION FLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CREATE WORKSPACE FLOW                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User clicks              User fills form          Frontend sends
"New Workspace"      â†’   (name, description)  â†’   POST /api/workspaces
                                                   + JWT token in header
                                                    â”‚
                                                    â†“
                                            Verify JWT token
                                            Extract user ID
                                                    â”‚
                                                    â†“
                                            Create workspace:
                                            {
                                              name: "...",
                                              description: "...",
                                              owner: userId,
                                              members: [
                                                {
                                                  user: userId,
                                                  role: "owner"
                                                }
                                              ]
                                            }
                                                    â”‚
                                                    â†“
                                            Save to MongoDB
                                            (workspaces collection)
                                                    â”‚
                                                    â†“
                                            Return workspace data
                                                    â”‚
                                                    â†“
                                            Frontend updates UI
                                            Shows new workspace


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       CREATE NOTE FLOW                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User clicks              User fills form          Frontend sends
"New Note"           â†’   (title, content,     â†’   POST /api/notes
                         workspace, tags)         + JWT token
                                                    â”‚
                                                    â†“
                                            Verify JWT token
                                            Extract user ID
                                                    â”‚
                                                    â†“
                                            Verify workspace exists
                                            & user has access
                                                    â”‚
                                                    â†“
                                            Create note:
                                            {
                                              title: "...",
                                              content: "...",
                                              workspace: workspaceId,
                                              author: userId,
                                              tags: [...],
                                              isPinned: false
                                            }
                                                    â”‚
                                                    â†“
                                            Save to MongoDB
                                            (notes collection)
                                                    â”‚
                                                    â†“
                                            Return note data
                                                    â”‚
                                                    â†“
                                            Frontend updates UI
                                            Shows new note
```

---

## ğŸ” **DATA RETRIEVAL FLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      GET USER DATA FLOW                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User visits              Frontend sends           API receives
/dashboard           â†’   GET /api/dashboard/  â†’   Request with JWT
                         summary + JWT token
                                                    â”‚
                                                    â†“
                                            Verify JWT token
                                            Extract user ID
                                                    â”‚
                                                    â†“
                                            Query MongoDB:
                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚ Count workspaces        â”‚
                                            â”‚ WHERE owner = userId    â”‚
                                            â”‚ OR members.user=userId  â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚ Count notes             â”‚
                                            â”‚ WHERE author = userId   â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚ Count documents         â”‚
                                            â”‚ WHERE author = userId   â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚ Count chats             â”‚
                                            â”‚ WHERE participants      â”‚
                                            â”‚ includes userId         â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                                    â†“
                                            Return summary:
                                            {
                                              workspaces: 2,
                                              notes: 5,
                                              documents: 3,
                                              aiChats: 1
                                            }
                                                    â”‚
                                                    â†“
                                            Frontend displays
                                            Real user data
                                            (No fake numbers!)
```

---

## ğŸ” **SECURITY FLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    JWT AUTHENTICATION FLOW                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Every Protected Request:

Frontend              Add JWT to header         Backend receives
makes request    â†’    Authorization:        â†’   Request
                      Bearer <token>
                                                    â”‚
                                                    â†“
                                            Extract token from
                                            Authorization header
                                                    â”‚
                                                    â†“
                                            Verify token:
                                            jwt.verify(token, JWT_SECRET)
                                                    â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚                               â”‚
                                 INVALID                         VALID
                                    â”‚                               â”‚
                                    â†“                               â†“
                            Return 401                    Extract user ID
                            "Unauthorized"                from token payload
                                                                    â”‚
                                                                    â†“
                                                          Find user in DB
                                                                    â”‚
                                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                    â”‚                               â”‚
                                                NOT FOUND                         FOUND
                                                    â”‚                               â”‚
                                                    â†“                               â†“
                                            Return 404                    Process request
                                            "User not found"              with user context
                                                                                    â”‚
                                                                                    â†“
                                                                          Return user-specific
                                                                          data only
```

---

## ğŸ—„ï¸ **DATABASE STRUCTURE**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MongoDB Collections                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USERS Collection                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                                            â”‚
â”‚   _id: ObjectId("..."),                                      â”‚
â”‚   name: "John Doe",                                          â”‚
â”‚   email: "john@example.com",                                 â”‚
â”‚   password: "$2a$10$...", // hashed                          â”‚
â”‚   role: "user",                                              â”‚
â”‚   avatar: "data:image/...",                                  â”‚
â”‚   bio: "...",                                                â”‚
â”‚   favoriteTopics: ["AI", "Tech"],                            â”‚
â”‚   createdAt: ISODate("..."),                                 â”‚
â”‚   updatedAt: ISODate("...")                                  â”‚
â”‚ }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ Referenced by (owner/author)
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WORKSPACES Collection                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                                            â”‚
â”‚   _id: ObjectId("..."),                                      â”‚
â”‚   name: "My Workspace",                                      â”‚
â”‚   description: "...",                                        â”‚
â”‚   owner: ObjectId("user_id"),  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   members: [                                      â”‚          â”‚
â”‚     {                                             â”‚          â”‚
â”‚       user: ObjectId("user_id"), â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚       role: "owner",                                         â”‚
â”‚       joinedAt: ISODate("...")                               â”‚
â”‚     }                                                        â”‚
â”‚   ],                                                         â”‚
â”‚   tags: ["project", "work"],                                 â”‚
â”‚   createdAt: ISODate("...")                                  â”‚
â”‚ }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ Referenced by (workspace)
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NOTES Collection                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                                            â”‚
â”‚   _id: ObjectId("..."),                                      â”‚
â”‚   title: "My Note",                                          â”‚
â”‚   content: "Note content...",                                â”‚
â”‚   workspace: ObjectId("workspace_id"), â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   author: ObjectId("user_id"), â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”       â”‚
â”‚   tags: ["important", "todo"],                   â”‚   â”‚       â”‚
â”‚   isPinned: false,                               â”‚   â”‚       â”‚
â”‚   isArchived: false,                             â”‚   â”‚       â”‚
â”‚   createdAt: ISODate("...")                      â”‚   â”‚       â”‚
â”‚ }                                                â”‚   â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DOCUMENTS Collection                             â”‚   â”‚       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                                â”‚   â”‚       â”‚
â”‚   _id: ObjectId("..."),                          â”‚   â”‚       â”‚
â”‚   title: "Document.pdf",                         â”‚   â”‚       â”‚
â”‚   workspace: ObjectId("workspace_id"), â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚       â”‚
â”‚   author: ObjectId("user_id"), â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚   fileUrl: "...",                                            â”‚
â”‚   fileName: "document.pdf",                                  â”‚
â”‚   fileType: "application/pdf",                               â”‚
â”‚   extractedText: "...",                                      â”‚
â”‚   tags: ["report"],                                          â”‚
â”‚   createdAt: ISODate("...")                                  â”‚
â”‚ }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CHATS Collection                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                                            â”‚
â”‚   _id: ObjectId("..."),                                      â”‚
â”‚   title: "AI Conversation",                                  â”‚
â”‚   workspace: ObjectId("workspace_id"),                       â”‚
â”‚   participants: [ObjectId("user_id")],                       â”‚
â”‚   messages: [                                                â”‚
â”‚     {                                                        â”‚
â”‚       sender: ObjectId("user_id"),                           â”‚
â”‚       content: "Hello AI",                                   â”‚
â”‚       type: "user",                                          â”‚
â”‚       timestamp: ISODate("...")                              â”‚
â”‚     },                                                       â”‚
â”‚     {                                                        â”‚
â”‚       sender: ObjectId("ai_system"),                         â”‚
â”‚       content: "Hello! How can I help?",                     â”‚
â”‚       type: "ai",                                            â”‚
â”‚       timestamp: ISODate("...")                              â”‚
â”‚     }                                                        â”‚
â”‚   ],                                                         â”‚
â”‚   isAIConversation: true,                                    â”‚
â”‚   lastMessageAt: ISODate("...")                              â”‚
â”‚ }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ **FORGOT PASSWORD FLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FORGOT PASSWORD FLOW                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User clicks              User enters email        Frontend sends
"Forgot Password"    â†’   on form              â†’   POST /api/auth/
                                                   forgot-password
                                                    â”‚
                                                    â†“
                                            Find user by email
                                                    â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚                               â”‚
                                NOT FOUND                         FOUND
                                    â”‚                               â”‚
                                    â†“                               â†“
                            Return success          Generate 6-digit OTP
                            (security: don't        (e.g., 123456)
                            reveal if email                 â”‚
                            exists)                         â†“
                                                    Save to user:
                                                    {
                                                      resetOTP: "123456",
                                                      resetOTPExpires:
                                                        Date.now() + 5min
                                                    }
                                                            â”‚
                                                            â†“
                                                    Send OTP via email
                                                    (DEV: print to console)
                                                            â”‚
                                                            â†“
                                                    Return success message
                                                            â”‚
                                                            â†“
User sees                User enters OTP          Frontend sends
"Check email"        â†’   from email/console   â†’   POST /api/auth/
                                                   verify-otp
                                                    â”‚
                                                    â†“
                                            Find user by email
                                            Check OTP matches
                                            Check not expired
                                                    â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚                               â”‚
                                 INVALID                         VALID
                                    â”‚                               â”‚
                                    â†“                               â†“
                            Return error            Generate reset token
                            "Invalid OTP"           Return token
                                                            â”‚
                                                            â†“
User enters              Frontend sends           API receives
new password         â†’   POST /api/auth/      â†’   reset-password
                         reset-password           + token + new password
                                                    â”‚
                                                    â†“
                                            Verify reset token
                                            Hash new password
                                            Update user
                                            Clear reset fields
                                                    â”‚
                                                    â†“
                                            Return success
                                                    â”‚
                                                    â†“
                                            User can now login
                                            with new password
```

---

## ğŸ“Š **COMPLETE SYSTEM OVERVIEW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND (Next.js + React)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Login   â”‚  â”‚  Signup  â”‚  â”‚Dashboard â”‚  â”‚ Profile  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Notes   â”‚  â”‚Workspacesâ”‚  â”‚Documents â”‚  â”‚   Chat   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                  â”‚
â”‚  AuthContext (JWT token management)                             â”‚
â”‚  localStorage (token + user data)                               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ HTTP Requests (axios)
                         â”‚ Authorization: Bearer <JWT>
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND (Next.js API Routes)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Authentication:                                                 â”‚
â”‚  â”œâ”€ POST /api/auth/signup                                        â”‚
â”‚  â”œâ”€ POST /api/auth/login                                         â”‚
â”‚  â”œâ”€ GET  /api/auth/me                                            â”‚
â”‚  â”œâ”€ POST /api/auth/forgot-password                               â”‚
â”‚  â”œâ”€ POST /api/auth/verify-otp                                    â”‚
â”‚  â””â”€ POST /api/auth/reset-password                                â”‚
â”‚                                                                  â”‚
â”‚  Data Management:                                                â”‚
â”‚  â”œâ”€ GET/POST    /api/workspaces                                  â”‚
â”‚  â”œâ”€ GET/DELETE  /api/workspaces/[id]                             â”‚
â”‚  â”œâ”€ GET/POST    /api/notes                                       â”‚
â”‚  â”œâ”€ GET/DELETE  /api/notes/[id]                                  â”‚
â”‚  â”œâ”€ GET/POST    /api/documents                                   â”‚
â”‚  â”œâ”€ GET/DELETE  /api/documents/[id]                              â”‚
â”‚  â”œâ”€ GET/POST    /api/chats                                       â”‚
â”‚  â””â”€ GET/POST    /api/chats/[id]                                  â”‚
â”‚                                                                  â”‚
â”‚  Dashboard:                                                      â”‚
â”‚  â””â”€ GET /api/dashboard/summary                                   â”‚
â”‚                                                                  â”‚
â”‚  Profile:                                                        â”‚
â”‚  â”œâ”€ GET /api/profile                                             â”‚
â”‚  â”œâ”€ PUT /api/profile                                             â”‚
â”‚  â”œâ”€ GET /api/profile/stats                                       â”‚
â”‚  â””â”€ GET /api/profile/activity                                    â”‚
â”‚                                                                  â”‚
â”‚  AI Features:                                                    â”‚
â”‚  â”œâ”€ POST /api/ai/ask                                             â”‚
â”‚  â”œâ”€ POST /api/ai/generate                                        â”‚
â”‚  â””â”€ GET  /api/ai/summarize-document                              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Mongoose ODM
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE (MongoDB Atlas)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Database: ai-knowledge-workspace                                â”‚
â”‚                                                                  â”‚
â”‚  Collections:                                                    â”‚
â”‚  â”œâ”€ users          (authentication & profiles)                   â”‚
â”‚  â”œâ”€ workspaces     (collaboration spaces)                        â”‚
â”‚  â”œâ”€ notes          (user notes)                                  â”‚
â”‚  â”œâ”€ documentmodels (uploaded files)                              â”‚
â”‚  â””â”€ chats          (conversations & AI chats)                    â”‚
â”‚                                                                  â”‚
â”‚  Indexes:                                                        â”‚
â”‚  â”œâ”€ users.email (unique)                                         â”‚
â”‚  â”œâ”€ notes.author + notes.workspace                               â”‚
â”‚  â”œâ”€ workspaces.owner                                             â”‚
â”‚  â””â”€ chats.participants                                           â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ **KEY PRINCIPLES**

### **1. User Isolation**
```
Every query includes user ID:
- Notes: WHERE author = userId
- Workspaces: WHERE owner = userId OR members.user = userId
- Documents: WHERE author = userId
- Chats: WHERE participants includes userId

Result: Users ONLY see their own data
```

### **2. Authentication**
```
Every protected route:
1. Checks for JWT token
2. Verifies token signature
3. Extracts user ID
4. Proceeds with user context

No token = 401 Unauthorized
```

### **3. Data Integrity**
```
All relationships use ObjectId references:
- Note â†’ Workspace (workspace field)
- Note â†’ User (author field)
- Workspace â†’ User (owner field)
- Document â†’ Workspace (workspace field)

MongoDB ensures referential integrity
```

---

**ğŸ‰ This is your complete system architecture!**

**Everything is connected, secure, and user-specific.**
